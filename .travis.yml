language: node_js
node_js:
- '10'
cache: yarn
install: yarn install --frozen-lockfile
stages:
- name: test
- name: deploy
jobs:
  include:
  - stage: test
    script: yarn test
  - stage: deploy
    script:
    - yarn build:dev
    before_deploy:
    - export RELEASE_TAG=$(jq .version package.json | tr -d \" | cut -d . -f "1")
    - pip install --user awscli
    deploy:
    - provider: script
      script: "~/.local/bin/aws s3 sync dist/app s3://auth-dev.endpass.com --region=us-east-1
        --delete"
      skip_cleanup: true
      on:
        all_branches: true
        condition: "$TRAVIS_BRANCH =~ ^master$|^v[0-9]+\\.[0-9]+$"
    - provider: script
      script: "~/.local/bin/aws s3 sync dist/app s3://auth${RELEASE_TAG}-dev.endpass.com
        --region=us-east-1 --delete"
      skip_cleanup: true
      on:
        all_branches: true
        condition: "$TRAVIS_BRANCH =~ ^master$|^v[0-9]+\\.[0-9]+$"
notifications:
  slack:
    secure: AI2UOJEgAHPsknACUA9BQUmrtW3c5GSVAXDikN37IUSPahzKUqc2HRCHRJGWKdSjQdMct3x1NRRYniwmtHuL5eBANRzpCRHadDSrvEC1r4k4uBI7ngZirpbpWiv5URif7EV9i8w6ckWTUELjVvwX2qCISHWEWAe40FXXXpHtdTIsIG0lMb1d2z0i+Xmq1rPUPftaGjYBARSv11TCCMSMoyqTrJYH4Y3CXZUGGH5Ij80pgZh+lcROO6wgIjI2RHLPFWc8+YLMJFIii1tBT8REEnxiw+CYmocP5SzTdYOO7WTwhJpU9WmkR7XirHzCK/zlheZMMCXu0DwehaXC6gvd9+o9yV6X9qS69AIyJbVbZmldKT/Km1oF4GDsA6MfWv7DJQe/u8z8IsDqMandNfnbixix2ygVpPl7isUZS258uhbKEUUMSyk74TjbPb/dcXJYGzyKHR7KujgFrmIDXy4WmPRqROPW90eV5UAM6bJ/QjRiIPUqbNTfVQgS9aEwOAAQlWHIVl8+447MZ28I5xkPRfCibriprr8IlRGzbCbjIQ/ob7//dMvEppCf9UV/heGNS0vua4TbBnEPN5S1uOQcpp2+x5/cB0oVQPXsDzOyoPYsOZiJac81nmGtauoixUE+SwKh5IYfF5WDKWNR/E5HE9op4pXhxYaxXv4Reo9LgsA=
